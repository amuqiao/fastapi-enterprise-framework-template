# 11.1 常用命令

## 11.1.1 镜像管理命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker pull` | 拉取镜像 | `docker pull nginx:alpine` |
| `docker push` | 推送镜像到仓库 | `docker push myusername/myimage:1.0` |
| `docker build` | 构建镜像 | `docker build -t myimage:1.0 .` |
| `docker images` | 列出本地镜像 | `docker images` |
| `docker rmi` | 删除镜像 | `docker rmi myimage:1.0` |
| `docker tag` | 为镜像添加标签 | `docker tag myimage:1.0 myimage:latest` |
| `docker inspect` | 查看镜像详细信息 | `docker inspect nginx:alpine` |
| `docker history` | 查看镜像构建历史 | `docker history nginx:alpine` |
| `docker save` | 保存镜像到文件 | `docker save -o myimage.tar myimage:1.0` |
| `docker load` | 从文件加载镜像 | `docker load -i myimage.tar` |

## 11.1.2 容器管理命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker run` | 创建并启动容器 | `docker run -d --name mycontainer -p 80:80 nginx:alpine` |
| `docker start` | 启动容器 | `docker start mycontainer` |
| `docker stop` | 停止容器 | `docker stop mycontainer` |
| `docker restart` | 重启容器 | `docker restart mycontainer` |
| `docker pause` | 暂停容器 | `docker pause mycontainer` |
| `docker unpause` | 恢复暂停的容器 | `docker unpause mycontainer` |
| `docker rm` | 删除容器 | `docker rm mycontainer` |
| `docker ps` | 列出运行中的容器 | `docker ps` |
| `docker ps -a` | 列出所有容器 | `docker ps -a` |
| `docker exec` | 在容器内执行命令 | `docker exec -it mycontainer sh` |
| `docker logs` | 查看容器日志 | `docker logs mycontainer` |
| `docker logs -f` | 实时查看容器日志 | `docker logs -f mycontainer` |
| `docker stats` | 查看容器资源使用情况 | `docker stats mycontainer` |
| `docker inspect` | 查看容器详细信息 | `docker inspect mycontainer` |
| `docker top` | 查看容器内进程 | `docker top mycontainer` |
| `docker cp` | 在容器和宿主机之间复制文件 | `docker cp mycontainer:/etc/nginx/nginx.conf ./` |
| `docker diff` | 查看容器文件系统变化 | `docker diff mycontainer` |

## 11.1.3 网络管理命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker network create` | 创建网络 | `docker network create mynetwork` |
| `docker network ls` | 列出网络 | `docker network ls` |
| `docker network inspect` | 查看网络详细信息 | `docker network inspect mynetwork` |
| `docker network connect` | 连接容器到网络 | `docker network connect mynetwork mycontainer` |
| `docker network disconnect` | 断开容器与网络的连接 | `docker network disconnect mynetwork mycontainer` |
| `docker network rm` | 删除网络 | `docker network rm mynetwork` |
| `docker network prune` | 删除所有未使用的网络 | `docker network prune` |

## 11.1.4 数据卷管理命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker volume create` | 创建数据卷 | `docker volume create myvolume` |
| `docker volume ls` | 列出数据卷 | `docker volume ls` |
| `docker volume inspect` | 查看数据卷详细信息 | `docker volume inspect myvolume` |
| `docker volume rm` | 删除数据卷 | `docker volume rm myvolume` |
| `docker volume prune` | 删除所有未使用的数据卷 | `docker volume prune` |

## 11.1.5 系统管理命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker info` | 查看 Docker 系统信息 | `docker info` |
| `docker version` | 查看 Docker 版本信息 | `docker version` |
| `docker stats` | 查看系统资源使用情况 | `docker stats` |
| `docker events` | 查看 Docker 事件 | `docker events` |
| `docker system df` | 查看 Docker 磁盘使用情况 | `docker system df` |
| `docker system prune` | 删除所有未使用的资源 | `docker system prune` |
| `docker login` | 登录 Docker 仓库 | `docker login` |
| `docker logout` | 退出 Docker 仓库 | `docker logout` |
| `docker search` | 搜索 Docker 镜像 | `docker search nginx` |

## 11.1.6 常用选项说明

### 11.1.6.1 `docker run` 常用选项

| 选项 | 描述 | 示例 |
|------|------|------|
| `-d` | 后台运行容器 | `docker run -d nginx` |
| `-p` | 端口映射 | `docker run -p 80:80 nginx` |
| `-v` | 挂载卷 | `docker run -v myvolume:/data nginx` |
| `--name` | 指定容器名称 | `docker run --name mycontainer nginx` |
| `--network` | 指定网络 | `docker run --network mynetwork nginx` |
| `-e` | 设置环境变量 | `docker run -e MYVAR=value nginx` |
| `--restart` | 重启策略 | `docker run --restart always nginx` |
| `-u` | 指定用户 | `docker run -u 1000:1000 nginx` |
| `--read-only` | 只读文件系统 | `docker run --read-only nginx` |
| `--health-cmd` | 健康检查命令 | `docker run --health-cmd="curl -f http://localhost" nginx` |

### 11.1.6.2 `docker exec` 常用选项

| 选项 | 描述 | 示例 |
|------|------|------|
| `-i` | 交互式模式 | `docker exec -i mycontainer sh` |
| `-t` | 分配伪终端 | `docker exec -t mycontainer sh` |
| `-u` | 指定用户 | `docker exec -u root mycontainer sh` |
| `-e` | 设置环境变量 | `docker exec -e MYVAR=value mycontainer env` |

### 11.1.6.3 `docker logs` 常用选项

| 选项 | 描述 | 示例 |
|------|------|------|
| `-f` | 实时查看日志 | `docker logs -f mycontainer` |
| `--tail` | 显示最后 N 行日志 | `docker logs --tail 100 mycontainer` |
| `-t` | 显示时间戳 | `docker logs -t mycontainer` |
| `--since` | 显示指定时间之后的日志 | `docker logs --since 2023-01-01 mycontainer` |
| `--until` | 显示指定时间之前的日志 | `docker logs --until 2023-01-02 mycontainer` |

## 11.1.7 命令组合使用示例

### 11.1.7.1 快速部署一个 web 服务

```bash
# 拉取 nginx 镜像
docker pull nginx:alpine

# 运行 nginx 容器，映射端口 80
docker run -d --name nginx -p 80:80 nginx:alpine

# 查看容器状态
docker ps

# 访问 web 服务
curl http://localhost
```

### 11.1.7.2 构建并运行自定义镜像

```bash
# 在当前目录创建 Dockerfile
cat > Dockerfile << EOF
FROM nginx:alpine
COPY index.html /usr/share/nginx/html/
EOF

# 创建 index.html 文件
echo "<h1>Hello Docker!</h1>" > index.html

# 构建镜像
docker build -t mywebsite:1.0 .

# 运行容器
docker run -d --name mywebsite -p 8080:80 mywebsite:1.0

# 访问自定义网站
curl http://localhost:8080
```

### 11.1.7.3 管理多个容器

```bash
# 列出所有容器
docker ps -a

# 停止所有运行中的容器
docker stop $(docker ps -q)

# 删除所有已停止的容器
docker rm $(docker ps -a -q)

# 删除所有未使用的镜像
docker rmi $(docker images -f dangling=true -q)
```

## 11.1.8 快捷键和别名

### 11.1.8.1 常用别名

可以在 `~/.bashrc` 或 `~/.zshrc` 中添加以下别名，提高工作效率：

```bash
# Docker 常用别名
alias d='docker'
alias dps='docker ps'
alias dpa='docker ps -a'
alias di='docker images'
alias drun='docker run -d --name '
alias dstop='docker stop '
alias drm='docker rm '
alias drmi='docker rmi '
alias dlogs='docker logs -f '
alias dexec='docker exec -it '
alias dinspect='docker inspect '
alias dnetwork='docker network '
alias dvolume='docker volume '
alias dcompose='docker compose '
```

### 11.1.8.2 使用示例

```bash
# 使用别名列出容器
dps

# 使用别名运行容器
drun mynginx nginx:alpine

# 使用别名进入容器
dexec mynginx sh

# 使用别名查看日志
dlogs mynginx
```

## 11.1.9 最佳实践

1. **使用明确的容器名称**：便于管理和识别
2. **使用明确的镜像标签**：避免使用 `latest` 标签
3. **限制容器资源**：使用 `-m`、`--cpus` 等选项限制资源使用
4. **配置健康检查**：确保容器正常运行
5. **使用持久化存储**：避免数据丢失
6. **清理未使用的资源**：定期运行 `docker system prune`
7. **使用命令别名**：提高工作效率
8. **记录常用命令**：将常用命令保存为脚本