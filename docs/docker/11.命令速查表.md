# 11. 命令速查表

## 11.1 常用命令

### 11.1.1 镜像管理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker pull` | 拉取镜像 | `docker pull nginx:alpine` |
| `docker push` | 推送镜像 | `docker push myusername/myapp:1.0` |
| `docker build` | 构建镜像 | `docker build -t myapp:1.0 .` |
| `docker images` | 列出镜像 | `docker images` |
| `docker rmi` | 删除镜像 | `docker rmi nginx:alpine` |
| `docker tag` | 为镜像添加标签 | `docker tag myapp:1.0 myusername/myapp:1.0` |
| `docker inspect` | 查看镜像详情 | `docker inspect nginx:alpine` |
| `docker history` | 查看镜像历史 | `docker history nginx:alpine` |
| `docker search` | 搜索镜像 | `docker search nginx` |

### 11.1.2 容器管理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker run` | 创建并启动容器 | `docker run -d --name nginx -p 80:80 nginx:alpine` |
| `docker start` | 启动容器 | `docker start nginx` |
| `docker stop` | 停止容器 | `docker stop nginx` |
| `docker restart` | 重启容器 | `docker restart nginx` |
| `docker ps` | 列出容器 | `docker ps` |
| `docker ps -a` | 列出所有容器 | `docker ps -a` |
| `docker rm` | 删除容器 | `docker rm nginx` |
| `docker exec` | 在容器中执行命令 | `docker exec -it nginx sh` |
| `docker logs` | 查看容器日志 | `docker logs nginx` |
| `docker top` | 查看容器进程 | `docker top nginx` |
| `docker stats` | 查看容器资源使用情况 | `docker stats nginx` |
| `docker inspect` | 查看容器详情 | `docker inspect nginx` |
| `docker port` | 查看容器端口映射 | `docker port nginx` |
| `docker diff` | 查看容器文件系统变化 | `docker diff nginx` |
| `docker cp` | 复制文件到容器或从容器复制文件 | `docker cp index.html nginx:/usr/share/nginx/html/` |
| `docker pause` | 暂停容器 | `docker pause nginx` |
| `docker unpause` | 恢复容器 | `docker unpause nginx` |

### 11.1.3 网络管理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker network ls` | 列出网络 | `docker network ls` |
| `docker network create` | 创建网络 | `docker network create my-network` |
| `docker network inspect` | 查看网络详情 | `docker network inspect my-network` |
| `docker network connect` | 连接容器到网络 | `docker network connect my-network nginx` |
| `docker network disconnect` | 断开容器与网络的连接 | `docker network disconnect my-network nginx` |
| `docker network rm` | 删除网络 | `docker network rm my-network` |
| `docker network prune` | 删除所有未使用的网络 | `docker network prune` |

### 11.1.4 数据卷管理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker volume ls` | 列出数据卷 | `docker volume ls` |
| `docker volume create` | 创建数据卷 | `docker volume create my-volume` |
| `docker volume inspect` | 查看数据卷详情 | `docker volume inspect my-volume` |
| `docker volume rm` | 删除数据卷 | `docker volume rm my-volume` |
| `docker volume prune` | 删除所有未使用的数据卷 | `docker volume prune` |

### 11.1.5 系统管理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker info` | 查看系统信息 | `docker info` |
| `docker version` | 查看 Docker 版本 | `docker version` |
| `docker system df` | 查看 Docker 磁盘使用情况 | `docker system df` |
| `docker system prune` | 清理未使用的资源 | `docker system prune` |
| `docker events` | 查看系统事件 | `docker events` |
| `docker login` | 登录镜像仓库 | `docker login` |
| `docker logout` | 登出镜像仓库 | `docker logout` |

## 11.2 Docker Compose 常用命令

### 11.2.1 基本命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker-compose up` | 创建并启动服务 | `docker-compose up -d` |
| `docker-compose down` | 停止并删除服务 | `docker-compose down` |
| `docker-compose ps` | 列出服务状态 | `docker-compose ps` |
| `docker-compose logs` | 查看服务日志 | `docker-compose logs` |
| `docker-compose build` | 构建服务镜像 | `docker-compose build` |
| `docker-compose pull` | 拉取服务镜像 | `docker-compose pull` |
| `docker-compose push` | 推送服务镜像 | `docker-compose push` |
| `docker-compose config` | 验证 Compose 文件 | `docker-compose config` |
| `docker-compose version` | 查看 Compose 版本 | `docker-compose version` |

### 11.2.2 服务管理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker-compose start` | 启动服务 | `docker-compose start web` |
| `docker-compose stop` | 停止服务 | `docker-compose stop web` |
| `docker-compose restart` | 重启服务 | `docker-compose restart web` |
| `docker-compose rm` | 删除服务容器 | `docker-compose rm web` |
| `docker-compose exec` | 在服务容器中执行命令 | `docker-compose exec web sh` |
| `docker-compose run` | 运行一次性服务命令 | `docker-compose run web python manage.py migrate` |
| `docker-compose scale` | 缩放服务实例数量 | `docker-compose up -d --scale web=3` |

### 11.2.3 其他命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker-compose top` | 查看服务进程 | `docker-compose top` |
| `docker-compose pause` | 暂停服务 | `docker-compose pause web` |
| `docker-compose unpause` | 恢复服务 | `docker-compose unpause web` |
| `docker-compose images` | 列出服务镜像 | `docker-compose images` |
| `docker-compose port` | 查看服务端口映射 | `docker-compose port web 80` |

## 11.3 资源清理命令

### 11.3.1 容器清理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker container prune` | 删除所有未运行的容器 | `docker container prune` |
| `docker rm $(docker ps -a -q)` | 删除所有容器 | `docker rm $(docker ps -a -q)` |
| `docker rm $(docker ps -f status=exited -q)` | 删除所有已退出的容器 | `docker rm $(docker ps -f status=exited -q)` |

### 11.3.2 镜像清理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker image prune` | 删除所有未使用的镜像 | `docker image prune` |
| `docker image prune -a` | 删除所有未被使用的镜像 | `docker image prune -a` |
| `docker rmi $(docker images -q)` | 删除所有镜像 | `docker rmi $(docker images -q)` |
| `docker rmi $(docker images -f dangling=true -q)` | 删除所有悬空镜像 | `docker rmi $(docker images -f dangling=true -q)` |

### 11.3.3 数据卷清理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker volume prune` | 删除所有未使用的数据卷 | `docker volume prune` |
| `docker volume rm $(docker volume ls -q)` | 删除所有数据卷 | `docker volume rm $(docker volume ls -q)` |

### 11.3.4 网络清理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker network prune` | 删除所有未使用的网络 | `docker network prune` |
| `docker network rm $(docker network ls -q)` | 删除所有网络 | `docker network rm $(docker network ls -q)` |

### 11.3.5 系统资源清理

| 命令 | 描述 | 示例 |
|------|------|------|
| `docker system prune` | 清理所有未使用的资源 | `docker system prune` |
| `docker system prune -a` | 清理所有未被使用的资源 | `docker system prune -a` |
| `docker system prune --volumes` | 清理所有未使用的资源，包括数据卷 | `docker system prune --volumes` |
| `docker system prune -a --volumes` | 清理所有未被使用的资源，包括数据卷 | `docker system prune -a --volumes` |

## 11.4 常用选项

### 11.4.1 `docker run` 常用选项

| 选项 | 描述 | 示例 |
|------|------|------|
| `-d` | 后台运行容器 | `docker run -d nginx:alpine` |
| `--name` | 指定容器名称 | `docker run --name nginx nginx:alpine` |
| `-p` | 端口映射 | `docker run -p 80:80 nginx:alpine` |
| `-v` | 挂载数据卷 | `docker run -v nginx-data:/var/lib/nginx nginx:alpine` |
| `-e` | 设置环境变量 | `docker run -e MYSQL_ROOT_PASSWORD=123456 mysql:8.0` |
| `--network` | 连接到网络 | `docker run --network my-network nginx:alpine` |
| `--restart` | 重启策略 | `docker run --restart always nginx:alpine` |
| `-u` | 指定用户 | `docker run -u 1000:1000 nginx:alpine` |
| `--read-only` | 只读文件系统 | `docker run --read-only nginx:alpine` |
| `--cap-add` | 添加 Linux 能力 | `docker run --cap-add NET_BIND_SERVICE nginx:alpine` |
| `--cap-drop` | 删除 Linux 能力 | `docker run --cap-drop ALL nginx:alpine` |

### 11.4.2 `docker build` 常用选项

| 选项 | 描述 | 示例 |
|------|------|------|
| `-t` | 指定镜像名称和标签 | `docker build -t myapp:1.0 .` |
| `-f` | 指定 Dockerfile 路径 | `docker build -f Dockerfile.prod -t myapp:prod .` |
| `--build-arg` | 设置构建参数 | `docker build --build-arg NODE_ENV=production -t myapp:prod .` |
| `--no-cache` | 不使用缓存 | `docker build --no-cache -t myapp:1.0 .` |
| `--pull` | 总是拉取最新基础镜像 | `docker build --pull -t myapp:1.0 .` |
| `--rm` | 构建成功后删除中间容器 | `docker build --rm -t myapp:1.0 .` |

## 11.5 命令组合技巧

### 11.5.1 批量操作

```bash
# 停止所有运行中的容器
docker stop $(docker ps -q)

# 删除所有容器
docker rm $(docker ps -a -q)

# 删除所有未运行的容器
docker rm $(docker ps -f status=exited -q)

# 删除所有镜像
docker rmi $(docker images -q)

# 删除所有悬空镜像
docker rmi $(docker images -f dangling=true -q)

# 清理所有未使用的资源
docker system prune -a --volumes
```

### 11.5.2 格式化输出

```bash
# 格式化容器列表
docker ps --format "table {{.ID}}\t{{.Names}}\t{{.Status}}\t{{.Ports}}"

# 格式化镜像列表
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"

# 格式化容器资源使用情况
docker stats --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.NetIO}}"
```

### 11.5.3 过滤输出

```bash
# 过滤正在运行的容器
docker ps -f status=running

# 过滤已退出的容器
docker ps -f status=exited

# 过滤指定名称的容器
docker ps -f name=nginx

# 过滤指定镜像的容器
docker ps -f ancestor=nginx:alpine

# 过滤指定网络的容器
docker ps -f network=my-network
```

## 11.6 快捷键

| 快捷键 | 描述 |
|--------|------|
| `Ctrl + C` | 停止当前运行的容器 |
| `Ctrl + P + Q` | 退出容器但保持容器运行 |
| `Ctrl + D` | 退出容器并停止容器 |

## 11.7 命令行技巧

### 11.7.1 使用别名

```bash
# 在 ~/.bashrc 或 ~/.zshrc 中添加别名
alias d="docker"
alias dc="docker-compose"
alias dps="docker ps"
alias dimg="docker images"
alias drun="docker run -d --name"
alias dstop="docker stop"
alias drm="docker rm"
alias dlogs="docker logs -f"

# 重载配置
source ~/.bashrc
```

### 11.7.2 使用 Bash 补全

```bash
# 安装 Bash 补全
# Ubuntu/Debian
sudo apt-get install bash-completion

# CentOS/RHEL
sudo yum install bash-completion

# 启用 Docker 补全
echo "source /usr/share/bash-completion/completions/docker" >> ~/.bashrc
echo "source /usr/share/bash-completion/completions/docker-compose" >> ~/.bashrc

# 重载配置
source ~/.bashrc
```

### 11.7.3 使用 Docker 命令行帮助

```bash
# 查看命令帮助
docker --help

# 查看子命令帮助
docker run --help

# 查看命令示例
docker run --help | grep -A 10 "Examples"
```

通过本章节的学习，您已经掌握了 Docker 常用命令、Docker Compose 常用命令和资源清理命令。命令速查表是 Docker 使用过程中的重要参考工具，熟练掌握这些命令将帮助您高效地管理和操作 Docker 环境。