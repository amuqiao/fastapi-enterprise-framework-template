# 使用uv初始化项目

```bash
mkdir test_uv_project
cd test_uv_project

# 使用uv初始化项目

uv init test_uv
Initialized project `test-uv` at `/Users/wangqiao/Documents/github_project/test_uv_project/test_uv`

tree
# 
.
└── test_uv
    ├── README.md
    ├── main.py
    └── pyproject.toml

# 显示隐藏文件    
tree -a   
.
├── .DS_Store
└── test_uv
    ├── .git
    │   ├── HEAD
    │   ├── config
    │   ├── description
    │   ├── hooks
    │   │   ├── applypatch-msg.sample
    │   │   ├── commit-msg.sample
    │   │   ├── fsmonitor-watchman.sample
    │   │   ├── post-update.sample
    │   │   ├── pre-applypatch.sample
    │   │   ├── pre-commit.sample
    │   │   ├── pre-merge-commit.sample
    │   │   ├── pre-push.sample
    │   │   ├── pre-rebase.sample
    │   │   ├── pre-receive.sample
    │   │   ├── prepare-commit-msg.sample
    │   │   ├── push-to-checkout.sample
    │   │   └── update.sample
    │   ├── info
    │   │   └── exclude
    │   ├── objects
    │   │   ├── info
    │   │   └── pack
    │   └── refs
    │       ├── heads
    │       └── tags
    ├── .gitignore
    ├── .python-version
    ├── README.md
    ├── main.py
    └── pyproject.toml
```

# `pyproject.toml` 默认配置

```bash
[project]
name = "test-uv"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = []
```

# 创建虚拟环境

```bash
# 创建虚拟环境 指定python版本
uv venv .venv --python=3.12.0

➜  test_uv git:(main) ✗ uv venv .venv --python=3.12
Using CPython 3.12.7 interpreter at: /opt/anaconda3/bin/python3.12
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate

# 激活虚拟环境
➜  test_uv git:(main) ✗ source .venv/bin/activate
(.venv) ➜  test_uv git:(main) ✗ which python
/Users/wangqiao/Documents/github_project/test_uv_project/test_uv/.venv/bin/python
```

# 管理依赖

## **添加新依赖**

```bash
uv add requests==2.32.3  # 默认在test_uv/pyproject.toml添加生产依赖
```

- 自动安装相关依赖
    
    ```bash
    (.venv) ➜  test_uv git:(main) ✗ uv add requests==2.32.3
    Resolved 6 packages in 5.47s
    Prepared 3 packages in 1.09s
    Installed 5 packages in 56ms
     + certifi==2025.4.26
     + charset-normalizer==3.4.2
     + idna==3.10
     + requests==2.32.3
     + urllib3==2.4.0
    ```
    
- `uv` 自动更新`test_uv/pyproject.toml` 配置
- 同时自动生成`test_uv/uv.lock` 文件
    
    ```bash
    dependencies = [
        "requests==2.32.3",
    ]
    ```
    

## **更新依赖**

```bash
uv update requests
```

## **移除依赖**

```bash
uv remove requests
```

## 添加开发依赖

- 使用 `uv add` 命令时，通过 `--project` 参数指定配置文件路径，并使用 `--dev` 标记添加开发依赖
    
    ```bash
    uv add --project test_uv/pyproject.toml --dev pytest  # 添加 pytest 到开发依赖
    uv add --project test_uv/pyproject.toml --dev black  # 添加 black 到开发依赖
    uv add --dev black  # 添加 black 到开发依赖
    
    # 示例
    (.venv) ➜  test_uv git:(main) ✗ uv add --dev black                         
    Resolved 13 packages in 1.72s
    Prepared 6 packages in 40.22s
    Installed 6 packages in 20ms
     + black==25.1.0
     + click==8.2.0
     + mypy-extensions==1.1.0
     + packaging==25.0
     + pathspec==0.12.1
     + platformdirs==4.3.8
    ```
    
- `uv` 自动更新`test_uv/pyproject.toml`
    
    ```bash
    [dependency-groups]
    dev = [
        "black>=25.1.0",
    ]
    ```
    

## 更新开发依赖

```bash
uv update --project test_uv/pyproject.toml --all  # 更新所有生产依赖
uv update --project test_uv/pyproject.toml fastapi  # 仅更新 fastapi（生产依赖）

uv update --project test_uv/pyproject.toml --all --dev  # 更新所有开发依赖
uv update --project test_uv/pyproject.toml pytest --dev  # 仅更新 pytest（开发依赖）
```

# **同步依赖**

从`test_uv/pyproject.toml`配置同步依赖到虚拟环境

## **仅同步生产依赖**

```bash
uv sync --project test_uv/pyproject.toml
```

此命令会根据 `[project.dependencies]` 安装生产环境依赖。

## **同步生产 + 开发依赖**

```bash
uv sync --project test_uv/pyproject.toml --dev
```

此命令会同时安装 `[project.dependencies]` 和 `[tool.uv.dev-dependencies]` 中的所有依赖。

## **参数说明**

| **参数** | **作用** |
| --- | --- |
| `--project PATH` | 指定 `pyproject.toml` 的路径（默认为当前目录）。 |
| `--dev` | 包含开发依赖（`dev-dependencies`）。 |
| `--no-lock` | 跳过 `uv.lock` 校验，直接使用 `pyproject.toml` 安装（不推荐）。 |

## **参数优先级说明**

| **参数组合** | **作用范围** |
| --- | --- |
| `uv update --all` | 仅更新生产依赖 |
| `uv update --all --dev` | 更新生产 + 开发依赖 |
| `uv update pytest` | 仅更新生产环境中的 `pytest` |
| `uv update pytest --dev` | 仅更新开发环境中的 `pytest` |

# 锁定版本

| 场景 | 命令示例 | 说明 |
| --- | --- | --- |
| **初始化项目** | `uv sync` | 根据 `uv.lock` 安装依赖（若无则生成）。 |
| **升级依赖** | `uv update --all` | 更新所有依赖并生成新的 `uv.lock`。 |
| **添加新依赖** | `uv add package-name` | 修改 `pyproject.toml` 并更新 `uv.lock`。 |
| **部署生产环境** | `uv sync` | 严格按照 `uv.lock` 安装，确保与开发环境一致。 |
| **测试新依赖** | `uv sync --no-lock` | 忽略 `uv.lock`，按 `pyproject.toml` 最新范围安装（慎用）。 |
| **手动刷新锁文件** | `uv lock` | 重新生成 `uv.lock`（不安装依赖）。可以将`pyproject.toml`修改为指定版本后更新 |

# **完整工作流程示例**

## **初始化项目**

```bash
mkdir test_uv && cd test_uv
uv init  # 生成基础 pyproject.toml
```

## **添加依赖**

```bash
# 添加生产依赖
uv add fastapi sqlalchemy

# 添加开发依赖
uv add --dev pytest ruff
```

## **同步到虚拟环境**

```bash
# 创建虚拟环境（如果尚未创建）
uv venv .venv --python=3.12

# 同步生产依赖
uv sync

# 同步开发依赖（在开发环境中）
uv sync --dev
```

## 更新依赖

```bash
uv update --all  # 更新所有依赖
uv update pytest  # 仅更新 pytest
```

## **检查依赖冲突**

```bash
uv check  # 验证依赖兼容性
```