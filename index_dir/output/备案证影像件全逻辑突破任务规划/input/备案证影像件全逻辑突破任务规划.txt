# 备案证 影像件全逻辑突破 任务规划

> 定目标，做计划，切实去执行
> 
> 

<div class="callout">

[POC\-MVP\-上线流程【产品开发与推进】](https://t0ah9wh5h5f.feishu.cn/wiki/SmL0w1hMQilJT2kmiB1c4S8on5d)

[任务细分\-子任务流水线模式【产品开发与推进】](https://t0ah9wh5h5f.feishu.cn/wiki/NBKawzR5kijFN0kXCRfcCQf6noC)

</div>

# 一、为什么要做？目标是啥？

> 输入 @ 插入相关云文档
> 
> 

1. 【智能审核影像件突破】备案证 影像件全逻辑突破，目标：全逻辑通过率45%，提升至60%左右（预估）

2. img\-to\-json；json\-to\-key,value；key,value\-to\-result===\&gt;img\-to\-json；json\-to\-result



# 二、什么时间完成？谁来完成？

🌟 同步块，复制并粘贴到其他文档，则可以实现跨文档实时更新和同步的效果。

1. 时间：2025/12/15——2026/01/09（可预估）

2. 负责人：@刘翰学@庄娘喜



# 三、怎么做？

> 输入 @ 提及相关负责人
> 
> 考虑：需求分析；子任务细分；方案设计；数据验证；输出结果
> 
> 



[备案证审核逻辑需明确点](https://ai.feishu.cn/wiki/KNY4wQla0impAqkKEGgcrSVHned)  \*\*问题沟通反馈\*\*

---

🌟 同步块，复制并粘贴到其他文档，则可以实现跨文档实时更新和同步的效果。

* [x] ~~需求分析~~

> 1. 经过上一次闭环优化，通过一阶段JSON提取，已将多数单逻辑准确率提升至很高的水平，现尝试对二阶段JSON优化以提升全逻辑通过率。
> 
> 2. 项目需求：重点关注全逻辑通过率较低的短板，修复容量逻辑，添加几个新逻辑（统一信用代码等），合并若干相关联逻辑，并向印章识别、地址识别等较难方向发力。
> 
> 

* [x] ~~子任务细分~~

> 1. 源数据获取与准备@姜凯隆
> 
> 2. 技术开发与验证@庄娘喜@刘翰学
> 
> 3. 工程化开发与集成@王宏睿
> 
> 4. 数据闭环与调优：
> 
> 

* [ ] 方案设计

> 1. 技术开发与验证
> 
>     1. 在当前的准确度上再有所提升，需对二阶段JSON作深度优化。（比上一次更具挑战，需要大量时间进行数据分析不断调优）。
> 
>     2. 公章识别作为全逻辑通过率短板，识别难度大；考虑先提取图片公章部分，再送入模型，并调研多个公章识别模型。
> 
> 2. 工程化开发与集成：\.\.\.\.\.\.
> 
> 

* [ ] 数据验证  

> 1. YOLOv5图片公章提取专用模型训练：@庄娘喜@刘翰学
> 
> YOLOv5n, YOLOv5s, YOLOv5m （nano:3\.61MB, small:13\.7MB, medium:40\.1MB）
> 
> 以上模型都能很好完成公章识别定位，提取率98%\+，可根据计算预算选取合适大小的模型。
> 
> 权重保存于：https://t0ah9wh5h5f\.feishu\.cn/drive/folder/CzjNfvdV5lRCWXdbCogc4265npd  
> 
> 如[yolov5s\_best\.onnx](https://t0ah9wh5h5f.feishu.cn/file/VtgVb5OjrorC7gxNd1vc8EHvnYf)
> 
> 公章提取功能模块[seal\_detector\.py](https://t0ah9wh5h5f.feishu.cn/file/AYcfbBtu8oSN04xjvLMcjjwRnVf)
> 
> 公章提取使用文档[seal\_dect\_readme\.md](https://t0ah9wh5h5f.feishu.cn/file/Ew7LbPc8soBDesxTSkMc87L4nv8)
> 
> 公章提取模块测试[test\_seal\_detector\.py](https://t0ah9wh5h5f.feishu.cn/file/CiuybBZP9oeLhvxWM7jcSNJLnxc)
> 
> 2. 用YOLO提取出的公章，对阿里OCR与百度OCR的公章识别模型进行对比，发现百度OCR对公章识别更加准确稳定，40批量样本内（阿里66\.7% vs\. 百度94\.4%\), 去除4个肉眼无法识别的样本。@庄娘喜@刘翰学
> 
>     对比分析结果[seal\_recognition\_results\_40\.xlsx](https://t0ah9wh5h5f.feishu.cn/file/YbQobzLdoo2cyvxfpHacZO4Innf)
> 
> 

* [ ] 输出结果

> 1. 
> 
> 2. 项目需求：\.\.\.\.\.\.
> 
> 



> **非需求任务 \*\*必填\*\***：填写任务投入资源；（非需求任务：AI服务建设的任务、预研的任务、未来得及给出需求的任务）
> 
> [\[产品需求\]AI团队建设工作投入【非需求，无需上线】](https://project.feishu.cn/tcldemo/storybank/detail/6458194568)
> 
> 



# 四、完成的结果

> 输入 @ 提及相关负责人，空格后输入 // 快速插入日期提醒
> 
> 输入 @ 插入项目云文档或文件
> 
> 

1. 任务一：描述内容，@某某人  ⏰2025-11-03 23:59

2. 任务二：\.\.\.\.\.\.



# 五、更多任务资料

> 输入 @ 插入项目云文档或文件
> 
> 可以在此归档会议纪要，也可以将每次项目会议的信息罗列在此，方便后续跟进复盘。
> 
> 

<table><tbody>
<tr>
<td>

**ai\_task\_name**

</td>
<td>

**修正AI准确率（release\-1127）**

</td>
<td>

**本次优化过程**

**step1**

</td>
<td>

**本次优化过程**

**step2**

</td>
<td>

**本次优化结果**

</td>
</tr>
<tr>
<td>

2004、备案证明\-项目主体和社会信用号对比



</td>
<td>

98\.5%

</td>
<td>

【新增】备案证编号（项目代码）

96\.7%（dev\-1225\-公司名称\-项目代码\-信用号）qwen\-plus

【待定】备案日期不准确

</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>

2005、备案证明\-项目地址比对

</td>
<td>

97\.9%

</td>
<td>

【新增】项目名称内的地址审核



</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>

2006、备案证明\-判断备案容量是否满足资方要求

</td>
<td>

96\.1%

</td>
<td>

【修改】1215新规：以交流侧备案\(单户\)

~~96\.1%（dev\-1225）~~

1229会议，审核要点变为

【逆变器功率和=交流备案容量=系统容量字段】
逆变器功率和字段需重新拉取

</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>

2007、备案证明\-判断备案证是否需出具备案明细

</td>
<td>

96\.9%

</td>
<td>

提示词优化



</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>

2008、备案证明\-根据文件形式判断是否加盖发改委公章或提供备案成功截图

</td>
<td>

76\.2%

\[未参与优化\]

</td>
<td>

【技术优化】百度OCR

1229会议 决定保留



</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>

2009、备案证明\-核验系统备案信息相关字段\_备案证编号

</td>
<td>

100\.0%

</td>
<td>

【删除】与2004合并

可用于单独审核备案日期

</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>

2010、备案证明\-核验系统备案信息相关字段\_备案容量

</td>
<td>

87\.7%

\[规则待定\]

</td>
<td>

【删除】原逻辑与2006合并

~~【新增】备案证容量（总容量）~~

~~89\.7%（dev\-1229）~~
 1229会议 决定不审核



</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>

2011、备案证明\-核验系统备案信息相关字段\_项目地址

（是否多个电站，是否有明细）

</td>
<td>

97\.9%

</td>
<td>

提示词优化，废弃代码判断逻辑

1229会议 决定保留

92\.3%（dev\-1229）

</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>



</td>
<td>



</td>
<td>



</td>
<td>



</td>
<td>



</td>
</tr>
</tbody></table>

<table><tbody>
<tr>
<td>

任务id

</td>
<td>

task\_model\_name\.yml

</td>
<td>

prompts\_200\.yml \(release\-1127\)

</td>
<td>

prompts\_200\.yml \(release\-01xx\)

</td>
</tr>
<tr>
<td>

2004

</td>
<td>

```Python
"2004、备案证明-项目主体和社会信用号对比":
    one_stage: "qwen-plus"
```

</td>
<td>

```Bash
"record_certificate_1": &record_certificate_1
    task_name: "2004、备案证明-项目主体和社会信用号对比"
    task_id: "2004"
    prompt_template: |
       <instructions>
          <role>
            你作为光伏工程高级审核专家,你的任务是从光伏电站并网部分的资质文件等信息中提取关键信息进行审核.
            请遵守根据<rule>规则，提取备案文件信息中的项目公司企业（法人)全称。
          </role>

          <input_data>
            备案文件信息：{image_to_json_content}
          </input_data>

          <rule>
            1.要求准确无误的提取上述关键信息、不要遗漏和捏造虚假信息，不确定的信息可以用英文问号?代替。
            2.项目公司: 也称为企业（法人）全称 / 申报企业名称 / 项目单位名称 / 项目单位全称 / 法人企业全称
            3.取值优先级："申报企业名称"字段，若无则查看明细表中用户姓名为{cust_name}的公司名字（提取后不需要包含括号里面的名字）
            4.若备案文件信息里面按优先级取值均 无项目公司的，则返回 "未识别到项目公司"。
            5.注意，请不要提取项目公司(企业全称)以外的信息，提取的内容需要符合以下格式要求：
              将结果输出为JSON格式，不要输出```json```代码段，仅输出结果,如<output_format>所示
          </rule>

          <output_format>
            {
              "识别项目公司": "xxx"
            }
          </output_format>

       </instructions>
```

</td>
<td>

```Bash
"record_certificate_1": &record_certificate_1
    task_name: "2004、备案证明-项目主体和社会信用号对比"
    task_id: "2004"
    prompt_template: |      
      <instructions>
          <role>
              你是一名资深的信息比对专家，具备精准的信息提取能力和严格的数据比对能力。
              你的任务仅限于：
              1. 从【备案文件信息】中提取【项目公司】与【统一社会信用代码】；
              2. 与【系统登记信息】逐条比对；
              3. 按规定输出结果。
          </role>

          <input_data>
              <备案文件信息>{image_to_json_content} </备案文件信息>
              <系统登记项目公司_比对专用>{company_name}</系统登记项目公司_比对专用>
              <系统登记社会信用代码_比对专用>{unified_social_credit_code}</系统登记社会信用代码_比对专用>
              <系统登记用户姓名>{cust_name}</系统登记用户姓名>
          </input_data>

        <hard_constraints>
              1. 原文逐字提取：识别结果必须是【备案文件信息】原文的连续子串（逐字一致）；不得补全/纠正/猜测/推断；不得纠正错别字或高频词（如"碳中合→碳中和"、"科枝→科技"）；识别结果若非缺失占位词，则必须能在原文中以连续子串逐字找到，否则视为提取失败需要重新提取。
              2. 字段锁定与全局一致性：content 一旦写入识别结果，后续所有位置（step_by_step_analysis、原因等）不得重新生成/改写，只能逐字复制引用；输出前必须自检 JSON 内所有公司名/信用码字符串与 content 对应字段逐字一致，若不一致必须以 content 为准修正。
              3. 字段缺失处理：备案缺字段或字段值为空，必须输出指定缺失占位词（公司："未识别到项目公司"；信用码："无统一社会信用代码，不需要审核"）。
              4. 输出格式规范：①需要遵守 <hard_constraints>并按照<output_format>输出可被 JSON 解析；②仅包含 output_format 中定义的键；③不输出 markdown/```/多余字段/多余解释；④"审核结果""原因"与 step_by_step_analysis 的结论一致。
              5. 禁止改变规则：不得改变、增加、删减判定条件与流程顺序。
          </hard_constraints>
      

          <workflow>

          以下为任务工作流程，需要严格按照步骤进行且遵守<hard_constraints>约束规则：
          Step1 提取项目公司（仅来自备案文件信息）：
              - 识别同义字段：项目公司/企业（法人）全称/申报企业名称/项目单位名称/项目单位全称/法人企业全称 等。
              - 优先级1：若存在“申报企业名称”（或同义字段）且值非空 → 直接提取该值为【项目公司】,一字不可改。
              - 优先级2：若优先级1无结果 → 在明细表中找“用户姓名={cust_name}”对应的公司名称：
                  * 若用户姓名为 "xx"，明细表出现 "xx" 或 "xx+数字编号" → 允许匹配并提取对应公司（必须执行）。
                  * 若用户姓名为 "xx+数字编号" → 只能匹配完全相同的 "xx+数字编号"。
                  * 清洗规则：仅提取公司名称主体，移除括号内的个人姓名；例：XX公司（张三）→ XX公司。
              - 若仍无结果 → 【项目公司】="未识别到项目公司"。
      

          Step2 提取统一社会信用代码（仅来自备案文件信息）：
              - 查找字段：统一社会信用代码/社会信用代码/统一信用代码 等。
              - 若字段未找到或为空 → 【统一社会信用代码】="无统一社会信用代码，不需要审核"。
              - 若字段非空 → 原样提取完整字符串（保留备案原文中的空格/符号；不得截断；不得自行去空格）。
              

          Step3 比对项目公司（提取值 vs 系统项目公司）：
              - 允许标准化（仅用于比对，不回写到识别结果）：全角/半角符号统一；裁剪首尾空格。禁止任何字符改写/纠错。
              - 一致条件：
              (a) 标准化后逐字完全匹配；
              (b) 仅允许公司名称最前方行政区前缀的增减（允许多个行政区前缀，不需要校对公司名字里的行政区之间的归属是否正确，因为可能出现异地创建的公司）；除前缀外其余部分必须逐字一致。（例：xx县xx有限公司 vs xx有限公司 → 一致）。
                  前缀出现替换（不是增减）→ 不一致。（例：xx县xx有限公司 vs yy县xx有限公司 → 不一致）。
                  行政区前缀仅限出现在名称最前方；不得将中间位置字符视为可增减前缀。
              - 不一致条件：
              (a) Step1 为“未识别到项目公司”；
              (b) 除行政区前缀差异外存在任何字符差异（如增删改、错别字、同音字、形近字等）。

          Step4 比对统一社会信用代码（提取值 vs 系统社会信用号）：
              - 比对标准化（仅用于比对，不回写到识别结果）：字母统一转大写；裁剪首尾空格。
              - 若 Step2 为“无统一社会信用代码，不需要审核” → 比对结果="无需比对"。
              - 否则：标准化后逐字完全匹配 → "一致"；存在任何字符差异 → "不一致"。

          Step5 最终结论：
              - 通过：项目公司比对=一致 且（社会信用号比对=一致 或 无需比对）。
              - 不通过：公司比对=不一致 或 社会信用号比对=不一致 或 Step1 未识别到项目公司。

          Step6 把结果整理到 <output_format>的json里面，并自我检查，是否符合<hard_constraints>

          </workflow>

          <output_format>
              {
                  "step_by_step_analysis": "workflow逐步分析 step_1~step_5 的结论",
                  "审核结果": "通过/不通过",
                  "原因": "必须按模板输出：备案项目公司:\"<content.项目公司.识别结果>\" vs 系统项目公司:\"<系统项目公司>\"；备案统一社会信用代码:\"<content.统一社会信用代码.识别结果>\" vs 系统社会信用号:\"<系统社会信用号>\"；公司比对:<一致/不一致>；信用码比对:<一致/不一致/无需比对>。",
                  "content": {
                      "项目公司": {
                          "识别结果": "Step1 提取项目公司",
                          "是否一致": "Step3的结果：一致/不一致"
                      },
                      "统一社会信用代码": {
                          "识别结果": "Step2 提取统一社会信用代码",
                          "是否一致": "Step4 的结果一致/不一致/无需比对"
                      }
                  }
              }
          </output_format>
      </instructions>
```

</td>
</tr>
<tr>
<td>



</td>
<td>



</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>



</td>
<td>



</td>
<td>



</td>
<td>



</td>
</tr>
<tr>
<td>



</td>
<td>



</td>
<td>



</td>
<td>



</td>
</tr>
</tbody></table>

<table><tbody>
<tr>
<td>

修改原因

</td>
<td>

代码文件路径

</td>
<td>

修改内容

</td>
</tr>
<tr>
<td>

输出JSON字段原代码为OCR\_content，现需要兼容无OCR前缀的content字段

</td>
<td>

src\\processing\\process\_base\.py

</td>
<td>

需要在键名别名映射key\_aliases 的content列表加入content，若其余代码有使用的需要同步兼容

</td>
</tr>
</tbody></table>







<table><tbody><tr>
<td>



</td>
<td>

END

</td>
<td>

记得更新产品需求文档，如有！

</td>
</tr></tbody></table>



