# Swagger UI Authorize功能使用指南

## 功能概述

Swagger UI是FastAPI自动生成的交互式API文档，其中的"Authorize"功能允许您在文档界面中直接授权访问受保护的API端点。通过该功能，您可以：
- 在Swagger UI中直接进行身份认证
- 自动将认证信息附加到所有请求中
- 测试所有受保护的API端点
- 无需手动构建请求头

## 技术原理

1. **认证方式**：基于OAuth2.0 Bearer Token
2. **令牌存储**：保存在浏览器会话中
3. **自动附加**：授权后，所有请求自动添加Authorization头
4. **支持多种认证类型**：Bearer Token、API Key、OAuth2等

## 前提条件

1. 已启动API服务
2. 已访问Swagger UI页面（默认：http://localhost:8001/docs）
3. 已拥有有效的用户账号
4. 了解如何获取访问令牌

## 操作步骤

### 1. 访问Swagger UI

打开浏览器，访问API服务的Swagger UI页面：
```
http://localhost:8001/docs
```

### 2. 注册新用户（可选）

如果您还没有账号，可以先注册一个：

1. 找到`POST /api/v1/auth/register`端点
2. 点击"Try it out"按钮
3. 填写用户信息（用户名、邮箱、密码）
4. 点击"Execute"按钮
5. 查看响应，确认注册成功

### 3. 获取访问令牌

使用已有的账号登录获取访问令牌：

1. 找到`POST /api/v1/auth/login`端点
2. 点击"Try it out"按钮
3. 填写登录凭证（用户名、密码）
4. 点击"Execute"按钮
5. 在响应中找到`access_token`字段，复制其值

### 4. 使用Authorize功能

#### 4.1 打开授权对话框

在Swagger UI页面顶部，找到并点击"Authorize"按钮：

![Authorize按钮位置](https://fastapi.tiangolo.com/img/tutorial/security/image-01.png)

#### 4.2 填写授权信息

在弹出的授权对话框中：

1. 在"Value"输入框中输入访问令牌
2. 令牌格式：`Bearer <your_access_token>`（注意"Bearer"后有一个空格）
3. 例如：`Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
4. 点击"Authorize"按钮完成授权
5. 点击"Close"按钮关闭对话框

![授权对话框](https://fastapi.tiangolo.com/img/tutorial/security/image-02.png)

#### 4.3 验证授权状态

授权成功后，"Authorize"按钮会显示一个绿色的锁图标，表示已授权：

![授权成功状态](https://fastapi.tiangolo.com/img/tutorial/security/image-03.png)

### 5. 测试受保护端点

授权成功后，您可以测试任何受保护的API端点：

1. 找到一个受保护的端点（带有锁图标🔒）
2. 点击"Try it out"按钮
3. 填写必要的参数（如果有）
4. 点击"Execute"按钮
5. 查看响应结果

**注意**：授权后，Swagger UI会自动将Authorization头添加到所有请求中，无需手动设置。

### 6. 退出授权

如果您想取消授权，可以：

1. 再次点击"Authorize"按钮
2. 在授权对话框中点击"Logout"按钮
3. 点击"Close"按钮关闭对话框

退出授权后，"Authorize"按钮的绿色锁图标会消失，所有请求不再包含认证信息。

## 常见问题解答

### 1. 授权后仍然无法访问受保护端点

**问题**：授权成功，但访问受保护端点时仍返回401错误。

**解决方案**：
- 检查令牌格式是否正确，确保包含"Bearer "前缀
- 检查令牌是否过期，过期后需要重新获取
- 检查令牌是否被篡改或无效
- 刷新浏览器页面，重新授权

### 2. 授权对话框中没有Bearer Token选项

**问题**：在授权对话框中看不到Bearer Token选项。

**解决方案**：
- 检查API服务是否正确配置了OAuth2认证
- 刷新Swagger UI页面
- 检查API端点是否使用了正确的依赖项

### 3. 授权信息丢失

**问题**：刷新页面后，授权信息丢失。

**解决方案**：
- 授权信息保存在浏览器会话中，刷新页面会丢失
- 重新进行授权操作
- 建议在测试过程中保持页面打开

### 4. 如何在多标签页间共享授权信息

**问题**：在新标签页打开Swagger UI，需要重新授权。

**解决方案**：
- 授权信息仅在当前标签页有效
- 每个标签页需要单独授权
- 考虑使用API客户端工具（如Postman）进行跨会话测试

### 5. 如何查看当前使用的令牌

**问题**：想查看当前授权使用的令牌。

**解决方案**：
- 点击"Authorize"按钮
- 在授权对话框中查看"Value"输入框中的内容
- 注意：令牌仅显示开头部分，完整令牌需要从登录响应中获取

## 最佳实践

1. **保护敏感信息**：
   - 不要在公共环境中泄露您的访问令牌
   - 退出时记得点击"Logout"按钮
   - 定期更新密码

2. **合理使用授权**：
   - 仅在需要测试受保护端点时授权
   - 测试完成后及时退出授权
   - 不要在生产环境的公共设备上进行授权

3. **令牌管理**：
   - 注意令牌有效期，及时刷新或重新获取
   - 不要将令牌硬编码到代码中
   - 考虑使用令牌管理工具

4. **测试策略**：
   - 先测试公开端点，再测试受保护端点
   - 测试不同权限级别的端点
   - 测试令牌过期场景

## 高级功能

### 1. 多认证方案支持

如果API支持多种认证方式，Swagger UI会在授权对话框中显示所有可用的认证方案，您可以选择其中一种进行授权。

### 2. 作用域（Scope）管理

对于支持OAuth2作用域的API，您可以在授权对话框中选择所需的权限范围。

### 3. 客户端凭证认证

对于客户端凭证模式，您可以在授权对话框中输入client_id和client_secret进行认证。

## 与其他工具对比

| 功能 | Swagger UI Authorize | Postman | curl |
|------|----------------------|---------|------|
| 可视化操作 | ✅ 是 | ✅ 是 | ❌ 否 |
| 自动附加认证信息 | ✅ 是 | ✅ 是 | ❌ 否 |
| 交互式测试 | ✅ 是 | ✅ 是 | ❌ 否 |
| 多环境支持 | ❌ 否 | ✅ 是 | ✅ 是 |
| 测试报告 | ❌ 否 | ✅ 是 | ❌ 否 |
| 团队协作 | ❌ 否 | ✅ 是 | ❌ 否 |

## 快捷键和技巧

1. **快速打开授权对话框**：点击页面顶部的"Authorize"按钮
2. **批量测试**：授权后可以连续测试多个受保护端点
3. **查看请求详情**：点击请求的"Headers"标签，查看自动添加的Authorization头
4. **复制请求**：点击"Copy curl"按钮，获取包含授权头的curl命令

## 浏览器兼容性

Swagger UI Authorize功能支持所有现代浏览器：
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 总结

Swagger UI Authorize功能是一个强大的工具，可以帮助您快速测试受保护的API端点。通过本指南，您应该已经了解了：

- 如何获取访问令牌
- 如何使用Authorize功能进行授权
- 如何测试受保护端点
- 如何解决常见问题
- 最佳实践和技巧

使用Swagger UI Authorize功能，可以大大提高API测试的效率和便捷性，同时保持良好的安全性。

---

**文档版本**：v1.0  
**更新日期**：2025-12-20  
**适用系统**：FastAPI Swagger UI
